generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  email      String     @unique(map: "User_email_key")
  name       String?
  image      String?
  birthDate  DateTime?
  birthTime  String?
  dayOfWeek  String?
  zodiacSign String?
  credits    Int        @default(0)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  password   String?
  isAdmin             Boolean                 @default(false)
  referrerId          String?
  commissionBalance   Float                   @default(0)
  downloads           Download[]
  orders              Order[]
  referrer            User?                   @relation("AffiliateNetwork", fields: [referrerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  referrals           User[]                  @relation("AffiliateNetwork")
  affiliateCodes      AffiliateCode[]
  commissionsReceived CommissionTransaction[] @relation("Receiver")
  payoutRequests      PayoutRequest[]

  @@index([referrerId], map: "User_referrerId_fkey")
  @@map("user")
}

model Wallpaper {
  id                 String             @id @default(cuid())
  title              String
  description        String?
  price              Int                @default(1)
  imageUrl           String
  categoryId         String
  blessing           String?
  deity              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  isNew              Boolean            @default(false)
  isPopular          Boolean            @default(false)
  isOffering         Boolean            @default(false)
  relatedWallpaperId String?
  downloadUrl        String?            // High-quality file for customers to download
  customOrders       CustomOrder[]
  downloads          Download[]
  slideshows         Slideshow[]
  category           Category           @relation(fields: [categoryId], references: [id])
  relatedWallpaper   Wallpaper?         @relation("WallpaperOfferings", fields: [relatedWallpaperId], references: [id], onUpdate: NoAction)
  offerings          Wallpaper[]        @relation("WallpaperOfferings")
  contents           WallpaperContent[]

  @@index([categoryId], map: "Wallpaper_categoryId_fkey")
  @@index([relatedWallpaperId], map: "Wallpaper_relatedWallpaperId_fkey")
  @@map("wallpaper")
}

model WallpaperContent {
  id           String    @id @default(cuid())
  wallpaperId  String
  imageUrl     String?
  text         String?   @db.Text
  textColor    String    @default("#FFFFFF")
  textSize     String    @default("base")
  textPosition String    @default("center")
  fontFamily   String    @default("sans")
  order        Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  wallpaper    Wallpaper @relation(fields: [wallpaperId], references: [id], onDelete: Cascade)

  @@index([wallpaperId], map: "wallpaper_content_wallpaperId_fkey")
  @@map("wallpaper_content")
}

model Category {
  id          String      @id @default(cuid())
  name        String      @unique(map: "Category_name_key")
  description String?
  bgColor     String      @default("#D9C4A1")
  imageUrl    String?
  order       Int         @default(0)
  subtitle    String?
  tooltip     String?
  bgImageUrl  String?
  textColor   String      @default("#1e293b")
  wallpapers  Wallpaper[]

  @@map("category")
}

model Order {
  id          String      @id @default(cuid())
  userId      String
  amount      Float
  credits     Int
  status      OrderStatus @default(PENDING)
  paymentType String
  paymentRef    String?     @unique(map: "Order_paymentRef_key")
  affiliateCode String?
  createdAt     DateTime    @default(now())
  user          User        @relation(fields: [userId], references: [id])

  @@index([userId], map: "Order_userId_fkey")
  @@map("order")
}

model Download {
  id           String    @id @default(cuid())
  userId       String
  wallpaperId  String
  customText   String?
  generatedUrl String?
  createdAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id])
  wallpaper    Wallpaper @relation(fields: [wallpaperId], references: [id])

  @@index([userId], map: "Download_userId_fkey")
  @@index([wallpaperId], map: "Download_wallpaperId_fkey")
  @@map("download")
}

model Article {
  id          String    @id @default(cuid())
  title       String
  content     String    @db.Text
  author      String?
  publishedAt DateTime?
  createdAt   DateTime  @default(now())

  @@map("article")
}

model Slideshow {
  id          String     @id @default(cuid())
  title       String
  subtitle    String?
  bgColor     String     @default("#D1A7FF")
  buttonText  String     @default("Get Now")
  imageUrl    String?
  wallpaperId String?
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  wallpaper   Wallpaper? @relation(fields: [wallpaperId], references: [id])

  @@index([wallpaperId], map: "Slideshow_wallpaperId_fkey")
  @@map("slideshow")
}

model CustomOrder {
  id            String      @id @default(cuid())
  wallpaperId   String
  displayedName String
  birthDate     String
  dayOfWeek     String
  zodiac        String
  email         String
  discountCode  String?
  totalAmount   Float
  status        OrderStatus @default(PENDING)
  paymentId     String?     @unique(map: "CustomOrder_paymentId_key")
  paymentMethod String?
  paymentStatus String      @default("UNPAID")
  affiliateCode String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  wallpaper     Wallpaper   @relation(fields: [wallpaperId], references: [id])

  @@index([wallpaperId], map: "CustomOrder_wallpaperId_fkey")
  @@map("customorder")
}

enum OrderStatus {
  PENDING
  SUCCESS
  FAILED
}

model Faq {
  id            String   @id @default(cuid())
  question      String   @db.Text
  answer        String   @db.Text
  questionColor String   @default("#000000")
  answerColor   String   @default("#4B5563")
  questionSize  String   @default("lg")
  answerSize    String   @default("base")
  fontFamily    String   @default("sans")
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("faq")
}

model AffiliateCode {
  id              String   @id @default(cuid())
  code            String   @unique(map: "AffiliateCode_code_key")
  discountPercent Float    @default(0)
  userId          String
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "AffiliateCode_userId_fkey")
  @@map("affiliate_code")
}

model CommissionRate {
  level      Int      @id
  percentage Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("commission_rate")
}

model CommissionTransaction {
  id                String   @id @default(cuid())
  userId            String
  fromOrderId       String?
  fromCustomOrderId String?
  amount            Float
  level             Int
  createdAt         DateTime @default(now())

  user              User     @relation("Receiver", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "CommissionTransaction_userId_fkey")
  @@index([fromOrderId], map: "CommissionTransaction_fromOrderId_index")
  @@index([fromCustomOrderId], map: "CommissionTransaction_fromCustomOrderId_index")
  @@map("commission_transaction")
}

model PayoutRequest {
  id        String       @id @default(cuid())
  userId    String
  amount    Float
  status    PayoutStatus @default(PENDING)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "PayoutRequest_userId_fkey")
  @@map("payout_request")
}

enum PayoutStatus {
  PENDING
  APPROVED
  REJECTED
}
