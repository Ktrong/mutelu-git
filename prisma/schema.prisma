generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  email      String     @unique(map: "User_email_key")
  name       String?
  image      String?
  birthDate  DateTime?
  birthTime  String?
  dayOfWeek  String?
  zodiacSign String?
  credits    Int        @default(0)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  password   String?
  isAdmin    Boolean    @default(false)
  downloads  Download[]
  orders     Order[]

  @@map("user")
}

model Wallpaper {
  id                 String             @id @default(cuid())
  title              String
  description        String?
  price              Int                @default(1)
  imageUrl           String
  categoryId         String
  blessing           String?
  deity              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  isNew              Boolean            @default(false)
  isPopular          Boolean            @default(false)
  isOffering         Boolean            @default(false)
  relatedWallpaperId String?
  downloadUrl        String?            // High-quality file for customers to download
  customOrders       CustomOrder[]
  downloads          Download[]
  slideshows         Slideshow[]
  category           Category           @relation(fields: [categoryId], references: [id])
  relatedWallpaper   Wallpaper?         @relation("WallpaperOfferings", fields: [relatedWallpaperId], references: [id], onUpdate: NoAction)
  offerings          Wallpaper[]        @relation("WallpaperOfferings")
  contents           WallpaperContent[]

  @@index([categoryId], map: "Wallpaper_categoryId_fkey")
  @@index([relatedWallpaperId], map: "Wallpaper_relatedWallpaperId_fkey")
  @@map("wallpaper")
}

model WallpaperContent {
  id           String    @id @default(cuid())
  wallpaperId  String
  imageUrl     String?
  text         String?   @db.Text
  textColor    String    @default("#FFFFFF")
  textSize     String    @default("base")
  textPosition String    @default("center")
  fontFamily   String    @default("sans")
  order        Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  wallpaper    Wallpaper @relation(fields: [wallpaperId], references: [id], onDelete: Cascade)

  @@index([wallpaperId], map: "wallpaper_content_wallpaperId_fkey")
  @@map("wallpaper_content")
}

model Category {
  id          String      @id @default(cuid())
  name        String      @unique(map: "Category_name_key")
  description String?
  bgColor     String      @default("#D9C4A1")
  imageUrl    String?
  order       Int         @default(0)
  subtitle    String?
  tooltip     String?
  bgImageUrl  String?
  textColor   String      @default("#1e293b")
  wallpapers  Wallpaper[]

  @@map("category")
}

model Order {
  id          String      @id @default(cuid())
  userId      String
  amount      Float
  credits     Int
  status      OrderStatus @default(PENDING)
  paymentType String
  paymentRef  String?     @unique(map: "Order_paymentRef_key")
  createdAt   DateTime    @default(now())
  user        User        @relation(fields: [userId], references: [id])

  @@index([userId], map: "Order_userId_fkey")
  @@map("order")
}

model Download {
  id           String    @id @default(cuid())
  userId       String
  wallpaperId  String
  customText   String?
  generatedUrl String?
  createdAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id])
  wallpaper    Wallpaper @relation(fields: [wallpaperId], references: [id])

  @@index([userId], map: "Download_userId_fkey")
  @@index([wallpaperId], map: "Download_wallpaperId_fkey")
  @@map("download")
}

model Article {
  id          String    @id @default(cuid())
  title       String
  content     String    @db.Text
  author      String?
  publishedAt DateTime?
  createdAt   DateTime  @default(now())

  @@map("article")
}

model Slideshow {
  id          String     @id @default(cuid())
  title       String
  subtitle    String?
  bgColor     String     @default("#D1A7FF")
  buttonText  String     @default("Get Now")
  imageUrl    String?
  wallpaperId String?
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  wallpaper   Wallpaper? @relation(fields: [wallpaperId], references: [id])

  @@index([wallpaperId], map: "Slideshow_wallpaperId_fkey")
  @@map("slideshow")
}

model CustomOrder {
  id            String      @id @default(cuid())
  wallpaperId   String
  displayedName String
  birthDate     String
  dayOfWeek     String
  zodiac        String
  email         String
  discountCode  String?
  totalAmount   Float
  status        OrderStatus @default(PENDING)
  paymentId     String?     @unique(map: "CustomOrder_paymentId_key")
  paymentMethod String?
  paymentStatus String      @default("UNPAID")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  wallpaper     Wallpaper   @relation(fields: [wallpaperId], references: [id])

  @@index([wallpaperId], map: "CustomOrder_wallpaperId_fkey")
  @@map("customorder")
}

enum OrderStatus {
  PENDING
  SUCCESS
  FAILED
}
